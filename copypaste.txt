from prob_price_above_intraday import probability_above_level_intraday
import pandas as pd

# Example 1 — ultra-fast closed-form
res = probability_above_level_intraday(
    ticker="SPY",
    threshold_price=520.0,                     # your strike / price level
    target_ts=pd.Timestamp("2025-10-20 16:00", tz="America/New_York"),  # today’s 4:00pm ET (regular equities)
    method="iid_normal",
    lookback_minutes=240                       # use last ~4 hours for vol
)
print(res.prob_above, res.details)

# Example 2 — bootstrap that respects intraday microstructure
res2 = probability_above_level_intraday(
    ticker="SPY",
    threshold_price=520.0,
    target_ts=pd.Timestamp("2025-10-20 16:00", tz="America/New_York"),
    method="intra_bootstrap",
    sims=75000,
    lookback_days=7,
    match_tod_window=45,   # sample returns around current time-of-day ±45m
    block=10               # 10-minute moving blocks
)
print(res2.prob_above, res2.details)